# UÃ§tan Uca AkÄ±ÅŸ: Desktop App â†” Gateway â†” Intelligence

> **DokÃ¼man:** 04-API/03-uctan-uca-desktop-intelligence.md
> **Son GÃ¼ncelleme:** 5 Åubat 2026
> **AkÄ±ÅŸ Tipi:** Belge Analizi

---

## ğŸ¯ Bu DokÃ¼manÄ±n AmacÄ±

Desktop uygulamasÄ±ndan belge analizinin nasÄ±l Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ±, Gateway ve Intelligence servisleri arasÄ±ndaki tÃ¼m API Ã§aÄŸrÄ±larÄ±nÄ± ayrÄ±ntÄ±lÄ± olarak aÃ§Ä±klar.

---

## ğŸ“Š Genel AkÄ±ÅŸ DiyagramÄ±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                DESKTOP APP â†” GATEWAY â†” INTELLIGENCE AKIÅI                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                          DESKTOP APP (Electron)                                  â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚
â”‚  â”‚   â”‚   Folder Watch   â”‚â”€â”€â”€â–¶â”‚   File Detect    â”‚â”€â”€â”€â–¶â”‚   Upload Queue           â”‚  â”‚â”‚
â”‚  â”‚   â”‚   (chokidar)     â”‚    â”‚   (new file)     â”‚    â”‚   (batch processing)     â”‚  â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚
â”‚  â”‚                                                                â”‚                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                    â”‚                  â”‚
â”‚                                                                    â”‚ 1. Analiz isteÄŸi â”‚
â”‚                                                                    â”‚                  â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                    â”‚                  â”‚
â”‚                                                                    â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                             GATEWAY (Node.js)                                    â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚   â”‚                           MIDDLEWARE CHAIN                                 â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”‚   CORS      â”‚â”€â”€â–¶â”‚  License    â”‚â”€â”€â–¶â”‚   Token     â”‚â”€â”€â–¶â”‚   Decrypt    â”‚  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”‚   Check     â”‚   â”‚   Validate  â”‚   â”‚   Check     â”‚   â”‚   Gemini Key â”‚  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                        â”‚                                         â”‚â”‚
â”‚  â”‚                                        â”‚ 2. Validate OK â†’ Forward                â”‚â”‚
â”‚  â”‚                                        â–¼                                         â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚   â”‚                        INTELLIGENCE PROXY                                  â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â”‚   Forward to: http://localhost:8001/api/v1/analyze                        â”‚ â”‚â”‚
â”‚  â”‚   â”‚   Add header: X-Gemini-Key: <decrypted_key>                               â”‚ â”‚â”‚
â”‚  â”‚   â”‚   Add header: X-Internal-Key: <service_key>                               â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                      â”‚               â”‚
â”‚                                                                      â”‚ 3. Forward    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                      â”‚               â”‚
â”‚                                                                      â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚                          INTELLIGENCE (Python/FastAPI)                           â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚   â”‚                          ANALYSIS PIPELINE                                 â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”‚   Pattern   â”‚â”€â”€â–¶â”‚   Gemini    â”‚â”€â”€â–¶â”‚   Entity    â”‚â”€â”€â–¶â”‚   Client     â”‚  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â”‚   Match     â”‚   â”‚   Analyze   â”‚   â”‚   Extract   â”‚   â”‚   Match      â”‚  â”‚ â”‚â”‚
â”‚  â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚â”‚
â”‚  â”‚   â”‚         â”‚                 â”‚                 â”‚                 â”‚            â”‚ â”‚â”‚
â”‚  â”‚   â”‚         â–¼                 â–¼                 â–¼                 â–¼            â”‚ â”‚â”‚
â”‚  â”‚   â”‚    ChromaDB          Google AI         MongoDB           MongoDB          â”‚ â”‚â”‚
â”‚  â”‚   â”‚    (patterns)           API           (entities)        (clients)         â”‚ â”‚â”‚
â”‚  â”‚   â”‚                                                                            â”‚ â”‚â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                                                                  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” API Ä°stekleri DetayÄ±

### 1. Desktop â†’ Gateway: Belge Analizi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST https://api.domizan.com/v1/documents/analyze                                  â”‚
â”‚                                                                                      â”‚
â”‚  Headers:                                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                          â”‚
â”‚  Content-Type: multipart/form-data                                                   â”‚
â”‚  X-License-Key: DOMIZAN-PRO5-K4Y4-SMMM                                              â”‚
â”‚  X-Device-Fingerprint: a1b2c3d4e5f6g7h8...64chars...                                â”‚
â”‚  X-App-Version: 1.1.0                                                               â”‚
â”‚                                                                                      â”‚
â”‚  Body (FormData):                                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                  â”‚
â”‚  file: [binary data - PDF/image]                                                    â”‚
â”‚  filename: "fatura_abc_ltd_2026.pdf"                                                â”‚
â”‚  source: "folder_watch"              // veya "manual_upload"                        â”‚
â”‚  sourcePath: "C:/Users/ahmet/Desktop/Belgeler/Gelen"                                â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GATEWAY Ä°Ã‡ Ä°ÅLEMLER                                                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  1. License doÄŸrula (X-License-Key)                                                 â”‚
â”‚     â”œâ”€â”€ License aktif mi?                                                           â”‚
â”‚     â”œâ”€â”€ Device onaylÄ± mÄ±? (fingerprint + license match)                             â”‚
â”‚     â””â”€â”€ Token kotasÄ± yeterli mi?                                                    â”‚
â”‚                                                                                      â”‚
â”‚  2. Gemini API Key'i Ã§Ã¶z (AES-256-GCM decrypt)                                     â”‚
â”‚     licenses.gemini_api_key_encrypted â†’ plaintext key                               â”‚
â”‚                                                                                      â”‚
â”‚  3. Intelligence'a forward et                                                       â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GATEWAY â†’ INTELLIGENCE FORWARD                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST http://localhost:8001/api/v1/analyze                                          â”‚
â”‚                                                                                      â”‚
â”‚  Headers:                                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                          â”‚
â”‚  Content-Type: multipart/form-data                                                   â”‚
â”‚  X-Internal-Key: abc123def456...internal_service_key...                             â”‚
â”‚  X-Gemini-Key: AIzaSyB...decrypted_customer_key...                                  â”‚
â”‚  X-License-Id: 660e8500-f39c-52e5-b827-557766550001                                 â”‚
â”‚                                                                                      â”‚
â”‚  Body: [orijinal dosya + metadata]                                                  â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  INTELLIGENCE RESPONSE â†’ GATEWAY â†’ DESKTOP                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  Response (200 OK):                                                                  â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": true,                                                                  â”‚
â”‚    "data": {                                                                         â”‚
â”‚      "documentId": "doc_770e8600-g40d-63f6-c938-668877660002",                      â”‚
â”‚      "analysis": {                                                                   â”‚
â”‚        "documentType": "fatura",                                                    â”‚
â”‚        "confidence": 0.95,                                                          â”‚
â”‚        "extractedData": {                                                            â”‚
â”‚          "issuer": {                                                                â”‚
â”‚            "name": "ABC LTD. ÅTÄ°.",                                                 â”‚
â”‚            "vkn": "1234567890",                                                     â”‚
â”‚            "address": "Ä°stanbul, TÃ¼rkiye"                                           â”‚
â”‚          },                                                                          â”‚
â”‚          "recipient": {                                                              â”‚
â”‚            "name": "Kaya SMMM",                                                     â”‚
â”‚            "vkn": "0987654321"                                                      â”‚
â”‚          },                                                                          â”‚
â”‚          "invoiceNumber": "FTR2026020001",                                          â”‚
â”‚          "date": "2026-02-01",                                                      â”‚
â”‚          "amount": {                                                                â”‚
â”‚            "subtotal": 1000.00,                                                     â”‚
â”‚            "vatRate": 20,                                                           â”‚
â”‚            "vatAmount": 200.00,                                                     â”‚
â”‚            "total": 1200.00,                                                        â”‚
â”‚            "currency": "TRY"                                                        â”‚
â”‚          }                                                                           â”‚
â”‚        },                                                                            â”‚
â”‚        "matchedClient": {                                                            â”‚
â”‚          "id": "client_880e9700-h51e-74g7-d049-779988770003",                       â”‚
â”‚          "name": "ABC LTD. ÅTÄ°.",                                                   â”‚
â”‚          "matchConfidence": 0.98,                                                   â”‚
â”‚          "matchField": "vkn"                                                        â”‚
â”‚        },                                                                            â”‚
â”‚        "suggestedFolder": "ABC LTD/2026/02/AlÄ±ÅŸ FaturalarÄ±",                        â”‚
â”‚        "suggestedFilename": "FTR2026020001_ABC_LTD_01022026.pdf"                    â”‚
â”‚      },                                                                              â”‚
â”‚      "tokensUsed": 1250,                                                            â”‚
â”‚      "tokensRemaining": 498750                                                      â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Desktop â†’ Gateway: Analiz OnayÄ±/Reddi

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST (KullanÄ±cÄ± OnayladÄ±)                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST https://api.domizan.com/v1/documents/doc_770e8600.../confirm                  â”‚
â”‚                                                                                      â”‚
â”‚  Headers:                                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                          â”‚
â”‚  Content-Type: application/json                                                      â”‚
â”‚  X-License-Key: DOMIZAN-PRO5-K4Y4-SMMM                                              â”‚
â”‚  X-Device-Fingerprint: a1b2c3d4e5f6g7h8...64chars...                                â”‚
â”‚                                                                                      â”‚
â”‚  Body:                                                                               â”‚
â”‚  â”€â”€â”€â”€â”€                                                                              â”‚
â”‚  {                                                                                   â”‚
â”‚    "action": "confirm",                                                             â”‚
â”‚    "finalFolder": "ABC LTD/2026/02/AlÄ±ÅŸ FaturalarÄ±",                                â”‚
â”‚    "finalFilename": "FTR2026020001_ABC_LTD_01022026.pdf",                           â”‚
â”‚    "matchedClientId": "client_880e9700-h51e-74g7-d049-779988770003",                â”‚
â”‚    "userConfirmedAt": "2026-02-05T16:45:00.000Z"                                    â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESPONSE (200 OK)                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": true,                                                                  â”‚
â”‚    "data": {                                                                         â”‚
â”‚      "documentId": "doc_770e8600-g40d-63f6-c938-668877660002",                      â”‚
â”‚      "status": "filed",                                                             â”‚
â”‚      "filedAt": "2026-02-05T16:45:01.000Z",                                         â”‚
â”‚      "finalPath": "C:/Users/ahmet/Domizan/ABC LTD/2026/02/AlÄ±ÅŸ FaturalarÄ±/..."      â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Desktop â†’ Gateway: Analiz DÃ¼zeltmesi (Ã–ÄŸrenme)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST (KullanÄ±cÄ± DÃ¼zeltti)                                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST https://api.domizan.com/v1/documents/doc_770e8600.../correct                  â”‚
â”‚                                                                                      â”‚
â”‚  Headers:                                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                          â”‚
â”‚  Content-Type: application/json                                                      â”‚
â”‚  X-License-Key: DOMIZAN-PRO5-K4Y4-SMMM                                              â”‚
â”‚  X-Device-Fingerprint: a1b2c3d4e5f6g7h8...64chars...                                â”‚
â”‚                                                                                      â”‚
â”‚  Body:                                                                               â”‚
â”‚  â”€â”€â”€â”€â”€                                                                              â”‚
â”‚  {                                                                                   â”‚
â”‚    "action": "correct",                                                             â”‚
â”‚    "corrections": {                                                                  â”‚
â”‚      "documentType": null,               // deÄŸiÅŸmedi                               â”‚
â”‚      "matchedClientId": "client_NEW123", // farklÄ± mÃ¼ÅŸteri seÃ§ildi                  â”‚
â”‚      "folder": "XYZ A.Å./2026/02/AlÄ±ÅŸ FaturalarÄ±",  // farklÄ± klasÃ¶r              â”‚
â”‚      "filename": null                    // deÄŸiÅŸmedi                               â”‚
â”‚    },                                                                                â”‚
â”‚    "correctionReason": "VKN aynÄ± ama farklÄ± ÅŸube",                                  â”‚
â”‚    "userConfirmedAt": "2026-02-05T16:50:00.000Z"                                    â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  GATEWAY â†’ INTELLIGENCE: Ã–ÄRENME                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST http://localhost:8001/api/v1/learn                                            â”‚
â”‚                                                                                      â”‚
â”‚  Body:                                                                               â”‚
â”‚  {                                                                                   â”‚
â”‚    "documentId": "doc_770e8600-g40d-63f6-c938-668877660002",                        â”‚
â”‚    "originalAnalysis": { ... },                                                     â”‚
â”‚    "corrections": { ... },                                                          â”‚
â”‚    "licenseId": "660e8500-f39c-52e5-b827-557766550001"                              â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”‚  Intelligence iÅŸlemleri:                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  1. MongoDB'ye dÃ¼zeltme kaydÄ± ekle (corrections collection)                         â”‚
â”‚  2. ChromaDB'de pattern gÃ¼ncelle (embedding + metadata)                             â”‚
â”‚  3. Gelecek analizler iÃ§in aÄŸÄ±rlÄ±k ayarla                                           â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESPONSE (200 OK)                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": true,                                                                  â”‚
â”‚    "data": {                                                                         â”‚
â”‚      "documentId": "doc_770e8600-g40d-63f6-c938-668877660002",                      â”‚
â”‚      "status": "corrected_and_filed",                                               â”‚
â”‚      "learningApplied": true,                                                       â”‚
â”‚      "patternUpdated": true,                                                        â”‚
â”‚      "message": "DÃ¼zeltme kaydedildi. Gelecek analizlerde dikkate alÄ±nacak."        â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Desktop â†’ Gateway: Lisans DoÄŸrulama (App BaÅŸlangÄ±cÄ±)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REQUEST                                                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  POST https://api.domizan.com/v1/licenses/verify                                    â”‚
â”‚                                                                                      â”‚
â”‚  Headers:                                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                          â”‚
â”‚  Content-Type: application/json                                                      â”‚
â”‚  X-License-Key: DOMIZAN-PRO5-K4Y4-SMMM                                              â”‚
â”‚                                                                                      â”‚
â”‚  Body:                                                                               â”‚
â”‚  â”€â”€â”€â”€â”€                                                                              â”‚
â”‚  {                                                                                   â”‚
â”‚    "fingerprint": "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0...",                    â”‚
â”‚    "deviceName": "DESKTOP-AHMET",                                                   â”‚
â”‚    "osType": "windows",                                                             â”‚
â”‚    "osVersion": "Windows 11 Pro 23H2",                                              â”‚
â”‚    "appVersion": "1.1.0",                                                           â”‚
â”‚    "ipAddress": "85.123.45.67"                     // otomatik algÄ±lanÄ±r            â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESPONSE - BaÅŸarÄ±lÄ± (Cihaz OnaylÄ±)                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": true,                                                                  â”‚
â”‚    "data": {                                                                         â”‚
â”‚      "valid": true,                                                                  â”‚
â”‚      "license": {                                                                    â”‚
â”‚        "key": "DOMIZAN-PRO5-K4Y4-SMMM",                                             â”‚
â”‚        "ownerName": "Ahmet Kaya",                                                   â”‚
â”‚        "companyName": "Kaya SMMM",                                                  â”‚
â”‚        "packageType": "pro",                                                        â”‚
â”‚        "expiresAt": "2027-02-05T00:00:00.000Z",                                     â”‚
â”‚        "daysRemaining": 365                                                         â”‚
â”‚      },                                                                              â”‚
â”‚      "device": {                                                                     â”‚
â”‚        "id": "dev_990e0800-i62f-85h8-e150-880099880004",                            â”‚
â”‚        "status": "approved",                                                        â”‚
â”‚        "isMaster": true                                                             â”‚
â”‚      },                                                                              â”‚
â”‚      "usage": {                                                                      â”‚
â”‚        "tokensUsed": 125000,                                                        â”‚
â”‚        "tokensLimit": 500000,                                                       â”‚
â”‚        "tokensRemaining": 375000,                                                   â”‚
â”‚        "resetDate": "2026-03-01T00:00:00.000Z"                                      â”‚
â”‚      },                                                                              â”‚
â”‚      "features": {                                                                   â”‚
â”‚        "documentAnalysis": true,                                                    â”‚
â”‚        "telegramIntegration": true,                                                 â”‚
â”‚        "multiDevice": true,                                                         â”‚
â”‚        "prioritySupport": true                                                      â”‚
â”‚      }                                                                               â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESPONSE - Yeni Cihaz (Onay Bekliyor)                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": true,                                                                  â”‚
â”‚    "data": {                                                                         â”‚
â”‚      "valid": true,                                                                  â”‚
â”‚      "license": { ... },                                                            â”‚
â”‚      "device": {                                                                     â”‚
â”‚        "id": "dev_AA0e0900-j73g-96i9-f261-991100991005",                            â”‚
â”‚        "status": "pending",                                                         â”‚
â”‚        "isMaster": false,                                                           â”‚
â”‚        "message": "Bu cihaz onay bekliyor. Admin onayladÄ±ktan sonra kullanabilirsiniz."â”‚
â”‚      },                                                                              â”‚
â”‚      "usage": null,                                                                  â”‚
â”‚      "features": null                                                               â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  RESPONSE - GeÃ§ersiz Lisans                                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  {                                                                                   â”‚
â”‚    "success": false,                                                                 â”‚
â”‚    "error": {                                                                        â”‚
â”‚      "code": "LICENSE_EXPIRED",                                                     â”‚
â”‚      "message": "LisansÄ±nÄ±z sona ermiÅŸ. Yenilemek iÃ§in bizimle iletiÅŸime geÃ§in.",   â”‚
â”‚      "expiredAt": "2026-01-01T00:00:00.000Z"                                        â”‚
â”‚    }                                                                                 â”‚
â”‚  }                                                                                   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Kod Ã–rnekleri

### Desktop App (Electron/TypeScript)

```typescript
// desktop/src/services/api.ts

const API_URL = import.meta.env.VITE_GATEWAY_URL;

class ApiService {
  private licenseKey: string | null = null;
  private fingerprint: string | null = null;

  setCredentials(licenseKey: string, fingerprint: string) {
    this.licenseKey = licenseKey;
    this.fingerprint = fingerprint;
  }

  private getHeaders(): HeadersInit {
    return {
      'X-License-Key': this.licenseKey || '',
      'X-Device-Fingerprint': this.fingerprint || '',
      'X-App-Version': __APP_VERSION__,
    };
  }

  async analyzeDocument(file: File, sourcePath: string): Promise<AnalysisResult> {
    const formData = new FormData();
    formData.append('file', file);
    formData.append('filename', file.name);
    formData.append('source', 'folder_watch');
    formData.append('sourcePath', sourcePath);

    const response = await fetch(`${API_URL}/v1/documents/analyze`, {
      method: 'POST',
      headers: this.getHeaders(),
      body: formData,
    });

    if (!response.ok) {
      const error = await response.json();
      throw new ApiError(error.error.code, error.error.message);
    }

    return response.json();
  }

  async confirmDocument(
    documentId: string,
    folder: string,
    filename: string,
    clientId: string
  ): Promise<void> {
    await fetch(`${API_URL}/v1/documents/${documentId}/confirm`, {
      method: 'POST',
      headers: {
        ...this.getHeaders(),
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        action: 'confirm',
        finalFolder: folder,
        finalFilename: filename,
        matchedClientId: clientId,
        userConfirmedAt: new Date().toISOString(),
      }),
    });
  }

  async verifyLicense(): Promise<LicenseVerifyResult> {
    const response = await fetch(`${API_URL}/v1/licenses/verify`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-License-Key': this.licenseKey || '',
      },
      body: JSON.stringify({
        fingerprint: this.fingerprint,
        deviceName: await getDeviceName(),
        osType: process.platform,
        osVersion: os.release(),
        appVersion: __APP_VERSION__,
      }),
    });

    return response.json();
  }
}

export const api = new ApiService();
```

### Gateway (Express)

```typescript
// gateway/src/routes/documents.ts

import { Router } from 'express';
import { validateLicense } from '../middleware/license';
import { validateDevice } from '../middleware/device';
import { checkTokenQuota } from '../middleware/quota';
import { decryptGeminiKey } from '../services/CryptoService';
import { forwardToIntelligence } from '../services/IntelligenceProxy';
import { LogService } from '../services/LogService';

const router = Router();

router.post(
  '/analyze',
  validateLicense,        // X-License-Key kontrolÃ¼
  validateDevice,         // X-Device-Fingerprint kontrolÃ¼
  checkTokenQuota,        // Token kotasÄ± kontrolÃ¼
  async (req, res) => {
    try {
      const { license } = req; // middleware'den geliyor
      
      // Gemini API key'i Ã§Ã¶z
      const geminiKey = await decryptGeminiKey(license.geminiApiKeyEncrypted);
      
      // Intelligence'a forward et
      const result = await forwardToIntelligence('/api/v1/analyze', {
        method: 'POST',
        headers: {
          'X-Internal-Key': process.env.INTERNAL_SERVICE_KEY,
          'X-Gemini-Key': geminiKey,
          'X-License-Id': license.id,
        },
        body: req.body,
        file: req.file,
      });
      
      // Token kullanÄ±mÄ±nÄ± logla
      await LogService.logTokenUsage(license.id, req.device.id, result.tokensUsed);
      
      res.json({
        success: true,
        data: {
          ...result,
          tokensRemaining: license.tokensRemaining - result.tokensUsed,
        },
      });
    } catch (error) {
      res.status(500).json({
        success: false,
        error: { code: 'ANALYSIS_FAILED', message: error.message },
      });
    }
  }
);

export default router;
```

### Intelligence (Python/FastAPI)

```python
# intelligence/app/routes/analyze.py

from fastapi import APIRouter, UploadFile, File, Header, HTTPException
from app.services.gemini_service import GeminiService
from app.services.pattern_service import PatternService
from app.services.client_service import ClientService
import logging

router = APIRouter()

@router.post("/api/v1/analyze")
async def analyze_document(
    file: UploadFile = File(...),
    x_internal_key: str = Header(...),
    x_gemini_key: str = Header(...),
    x_license_id: str = Header(...)
):
    # Internal key doÄŸrula
    if x_internal_key != settings.INTERNAL_SERVICE_KEY:
        raise HTTPException(401, "Invalid internal key")
    
    # DosyayÄ± oku
    content = await file.read()
    
    # 1. Pattern matching (ChromaDB)
    pattern_result = await PatternService.find_similar(content, x_license_id)
    
    # 2. Gemini analizi (mÃ¼ÅŸterinin key'i ile)
    gemini_service = GeminiService(api_key=x_gemini_key)
    analysis = await gemini_service.analyze_document(content, file.filename)
    
    # 3. Entity extraction
    entities = analysis.get("extractedData", {})
    
    # 4. Client matching (MongoDB)
    matched_client = await ClientService.find_by_vkn(
        entities.get("issuer", {}).get("vkn"),
        x_license_id
    )
    
    # 5. Folder suggestion
    suggested_folder = generate_folder_path(
        matched_client,
        analysis.get("documentType"),
        entities.get("date")
    )
    
    return {
        "documentId": generate_doc_id(),
        "analysis": {
            "documentType": analysis.get("documentType"),
            "confidence": analysis.get("confidence"),
            "extractedData": entities,
            "matchedClient": matched_client,
            "suggestedFolder": suggested_folder,
            "suggestedFilename": generate_filename(entities)
        },
        "tokensUsed": analysis.get("tokensUsed", 0)
    }
```

---

## âœ… GÃ¼venlik Ã–zeti

| Katman | Kontrol | Detay |
|--------|---------|-------|
| Desktop â†’ Gateway | X-License-Key | Lisans doÄŸrulama |
| Desktop â†’ Gateway | X-Device-Fingerprint | Cihaz yetkilendirme |
| Gateway â†’ Intelligence | X-Internal-Key | Servis arasÄ± gÃ¼ven |
| Gateway â†’ Intelligence | X-Gemini-Key | MÃ¼ÅŸteri API key (Ã§Ã¶zÃ¼lmÃ¼ÅŸ) |
| TÃ¼m katmanlar | HTTPS | TLS ÅŸifreleme |
| Gateway | Token Quota | Kota aÅŸÄ±mÄ± korumasÄ± |
