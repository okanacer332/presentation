# ERD ve Veri Modeli

> **DokÃ¼man:** 07-TEKNIK-MIMARI/04-erd-veri-modeli.md
> **Son GÃ¼ncelleme:** 5 Åubat 2026

---

## ğŸ“Š Entity Relationship Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              ENTITY RELATIONSHIP DIAGRAM                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                              PostgreSQL                                      â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚   â”‚     leads      â”‚          â”‚    licenses    â”‚          â”‚   devices    â”‚  â”‚   â”‚
â”‚   â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚   â”‚
â”‚   â”‚   â”‚ PK id          â”‚    1:1   â”‚ PK id          â”‚    1:N   â”‚ PK id        â”‚  â”‚   â”‚
â”‚   â”‚   â”‚    name        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ FK lead_id     â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ FK license_idâ”‚  â”‚   â”‚
â”‚   â”‚   â”‚    email       â”‚          â”‚    license_key â”‚          â”‚    hostname  â”‚  â”‚   â”‚
â”‚   â”‚   â”‚    phone       â”‚          â”‚    customer_*  â”‚          â”‚    fingerprntâ”‚  â”‚   â”‚
â”‚   â”‚   â”‚    company     â”‚          â”‚    package     â”‚          â”‚    ip_addressâ”‚  â”‚   â”‚
â”‚   â”‚   â”‚    vkn         â”‚          â”‚    status      â”‚          â”‚    status    â”‚  â”‚   â”‚
â”‚   â”‚   â”‚    status      â”‚          â”‚    gemini_key  â”‚          â”‚    is_master â”‚  â”‚   â”‚
â”‚   â”‚   â”‚    source      â”‚          â”‚    tg_bot_tokn â”‚          â”‚    last_activeâ”‚  â”‚   â”‚
â”‚   â”‚   â”‚    notes       â”‚          â”‚    max_devices â”‚          â”‚    created_atâ”‚  â”‚   â”‚
â”‚   â”‚   â”‚    created_at  â”‚          â”‚    token_limit â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â”‚   â”‚    updated_at  â”‚          â”‚    token_used  â”‚                            â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    expires_at  â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    created_at  â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    updated_at  â”‚                            â”‚   â”‚
â”‚   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚   â”‚
â”‚   â”‚                                       â”‚                                      â”‚   â”‚
â”‚   â”‚                                       â”‚ 1:N                                  â”‚   â”‚
â”‚   â”‚                                       â–¼                                      â”‚   â”‚
â”‚   â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚   â”‚
â”‚   â”‚                               â”‚  token_usage   â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚ PK id          â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚ FK license_id  â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    date        â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    tokens_used â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    request_cnt â”‚                            â”‚   â”‚
â”‚   â”‚                               â”‚    created_at  â”‚                            â”‚   â”‚
â”‚   â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                        â”‚   â”‚
â”‚   â”‚   â”‚     admins     â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚ PK id          â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚    email       â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚    password    â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚    name        â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚    role        â”‚                                                        â”‚   â”‚
â”‚   â”‚   â”‚    created_at  â”‚                                                        â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                        â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                               MongoDB                                        â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚   â”‚   â”‚      mukellefler       â”‚    1:N   â”‚       documents        â”‚            â”‚   â”‚
â”‚   â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ _id                    â”‚          â”‚ _id                    â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ licenseId              â”‚          â”‚ licenseId              â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ vknOrTc                â”‚          â”‚ mukellefId             â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ name                   â”‚          â”‚ originalName           â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ type (sahis/tuzel)     â”‚          â”‚ documentType           â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ email                  â”‚          â”‚ analysisResult         â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ phone                  â”‚          â”‚ extractedData          â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ address                â”‚          â”‚ status                 â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ folderPath             â”‚          â”‚ processedAt            â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ documentCount          â”‚          â”‚ approvedAt             â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ createdAt              â”‚          â”‚ filePath               â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ updatedAt              â”‚          â”‚ createdAt              â”‚            â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚   â”‚   â”‚   learning_patterns    â”‚          â”‚      reminders         â”‚            â”‚   â”‚
â”‚   â”‚   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ _id                    â”‚          â”‚ _id                    â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ licenseId              â”‚          â”‚ licenseId              â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ patternType            â”‚          â”‚ telegramChatId         â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ originalValue          â”‚          â”‚ reminderText           â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ correctedValue         â”‚          â”‚ reminderDate           â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ confidence             â”‚          â”‚ status                 â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ usageCount             â”‚          â”‚ createdAt              â”‚            â”‚   â”‚
â”‚   â”‚   â”‚ createdAt              â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚   â”‚
â”‚   â”‚                                                                              â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ Tablo DetaylarÄ±

### PostgreSQL TablolarÄ±

#### leads
| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| id | SERIAL PK | Primary key |
| name | VARCHAR(255) | Ä°sim soyisim |
| email | VARCHAR(255) | Email (unique) |
| phone | VARCHAR(20) | Telefon |
| company | VARCHAR(255) | Firma adÄ± |
| vkn | VARCHAR(11) | VKN |
| status | ENUM | new/contacted/demo_scheduled/converted/lost |
| source | VARCHAR(100) | landing_page/referral/direct |
| notes | TEXT | Notlar |
| created_at | TIMESTAMP | OluÅŸturma |
| updated_at | TIMESTAMP | GÃ¼ncelleme |

#### licenses
| Kolon | Tip | AÃ§Ä±klama |
|-------|-----|----------|
| id | SERIAL PK | Primary key |
| lead_id | INT FK | Lead referansÄ± |
| license_key | VARCHAR(50) | Lisans anahtarÄ± (unique) |
| customer_name | VARCHAR(255) | MÃ¼ÅŸteri adÄ± |
| customer_email | VARCHAR(255) | Email |
| customer_company | VARCHAR(255) | Firma |
| package | ENUM | basic/pro/enterprise |
| status | ENUM | active/suspended/expired |
| gemini_api_key | TEXT | Encrypted Gemini key |
| telegram_bot_token | TEXT | Encrypted bot token |
| telegram_bot_username | VARCHAR(100) | Bot username |
| max_devices | INT | Maksimum cihaz sayÄ±sÄ± |
| token_monthly_limit | BIGINT | AylÄ±k token limiti |
| token_used_this_month | BIGINT | KullanÄ±lan token |
| expires_at | TIMESTAMP | Lisans bitiÅŸ |
| created_at | TIMESTAMP | OluÅŸturma |
| updated_at | TIMESTAMP | GÃ¼ncelleme |

---

### MongoDB KoleksiyonlarÄ±

#### mukellefler
```json
{
  "_id": "ObjectId",
  "licenseId": "DOMIZAN-PRO5-XXXX",
  "vknOrTc": "1234567890",
  "name": "ABC Ltd. Åti.",
  "type": "tuzel",
  "email": "muhasebe@abc.com",
  "phone": "+90 532 123 4567",
  "address": "AtatÃ¼rk Cad. No:123 Ä°stanbul",
  "folderPath": "/MÃ¼kellefler/ABC Ltd",
  "documentCount": 156,
  "createdAt": "ISODate",
  "updatedAt": "ISODate"
}
```

#### documents
```json
{
  "_id": "ObjectId",
  "licenseId": "DOMIZAN-PRO5-XXXX",
  "mukellefId": "ObjectId",
  "originalName": "fatura_001.pdf",
  "documentType": "satis_faturasi",
  "analysisResult": {
    "confidence": 0.95,
    "extractedVkn": "1234567890",
    "documentDate": "2026-02-05",
    "amount": 12500.00,
    "documentNumber": "FTR-2026-0542"
  },
  "status": "approved",
  "processedAt": "ISODate",
  "approvedAt": "ISODate",
  "filePath": "/MÃ¼kellefler/ABC Ltd/2026/02/SatÄ±ÅŸ Fatura/...",
  "createdAt": "ISODate"
}
```

---

## ğŸ”— Ä°liÅŸki Ã–zeti

| Ä°liÅŸki | Kardinalite | AÃ§Ä±klama |
|--------|-------------|----------|
| leads â†’ licenses | 1:1 | Lead dÃ¶nÃ¼ÅŸÃ¼mÃ¼ |
| licenses â†’ devices | 1:N | Ã‡oklu cihaz |
| licenses â†’ token_usage | 1:N | GÃ¼nlÃ¼k kullanÄ±m |
| licenses â†’ mukellefler | 1:N | MÃ¼ÅŸteri mÃ¼kellefleri |
| mukellefler â†’ documents | 1:N | MÃ¼kellef belgeleri |

---

*Bu ÅŸema veritabanÄ± yapÄ±sÄ±nÄ±n referansÄ±dÄ±r.*
